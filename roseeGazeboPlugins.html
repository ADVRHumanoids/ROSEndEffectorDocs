

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ROS End-Effector Gazebo Plugins &mdash; ROSEndEffector 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Possible Issues" href="issues.html" />
    <link rel="prev" title="ROS End-Effector GUI" href="roseeGui.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> ROSEndEffector
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">How to use ROS End-Effector with your end-effector</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples with ready to use end-effectors</a></li>
</ul>
<p class="caption"><span class="caption-text">The Main Component</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="actions.html">ROS End-Effector Grasping Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="findActions.html">FindActions</a></li>
<li class="toctree-l1"><a class="reference internal" href="rosTopics.html">ROS Topics Structures</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="roseeGui.html">ROS End-Effector GUI</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ROS End-Effector Gazebo Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generic-information">Generic Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mimic-joints">Mimic Joints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-install">How to Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prepare-your-model-for-gazebo">Prepare your Model for Gazebo</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-run">How to Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced">Advanced</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#change-more-params-with-dynamic-reconfigurator">Change more params with Dynamic Reconfigurator</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="issues.html">Possible Issues</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="googleTests.html">How to run the google tests present in the package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ROSEndEffector</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ROS End-Effector Gazebo Plugins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/roseeGazeboPlugins.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ros-end-effector-gazebo-plugins">
<span id="roseegazeboplugins"></span><h1>ROS End-Effector Gazebo Plugins<a class="headerlink" href="#ros-end-effector-gazebo-plugins" title="Permalink to this headline">¶</a></h1>
<p>This package is an utility to help end effector dynamic simulation with Gazebo.
It is hosted on <em>github</em> <a class="reference external" href="https://github.com/ADVRHumanoids/rosee_gazebo_plugins">here</a>.</p>
<div class="section" id="generic-information">
<h2>Generic Information<a class="headerlink" href="#generic-information" title="Permalink to this headline">¶</a></h2>
<p>It is very similar to the “official” ROS package for control : <a class="reference external" href="http://gazebosim.org/tutorials/?tut=ros_control">gazebo_ros_control</a>.</p>
<p>It includes a gazebo plugin to take commands (<em>references</em>) from <strong>/ros_end_effector/joint_states</strong> topic and use to move the simulated robot in gazebo. This is done with a pid controller. The same plugin also publish the “real” joint states (derived by the gazebo simulation) in the topic <strong>/rosee_gazebo_plugins/joint_states</strong>.</p>
<p><strong>Take care:</strong> In <strong>/ros_end_effector/joint_states</strong> topic there are states for actuated joints only; while in <strong>/rosee_gazebo_plugins/joint_states</strong> there are states for ALL non-fixed joints (passive and mimic included). This may change in future, but for now I leave as it is because returning also mimic joints is not so a big problem.</p>
<p>At the moment each joint can be controlled in position or in velocity, using the <em>SetPositionTarget()</em> and <em>SetVelocityTarget()</em> of gazebo. Gains (pid) are settable in a config file (see later for istructions). Please note that for now ROS End-Effector sends only positional references.</p>
<p>In the package, there is an additional ROS node, <em>DynReconfigure</em>, which uses the ROS tool <em>Dynamic Reconfigure server</em> to give the possibility to change the PID gains during the simulation.</p>
<div class="section" id="mimic-joints">
<h3>Mimic Joints<a class="headerlink" href="#mimic-joints" title="Permalink to this headline">¶</a></h3>
<p>Thanks to the <a class="reference external" href="https://github.com/roboticsgroup/roboticsgroup_gazebo_plugins">mimic_joint_plugin</a> (and to <a class="reference external" href="https://github.com/mintar/mimic_joint_gazebo_tutorial">mimic_joint_gazebo_tutorial</a> to understand how to use it), now also mimic joints work correctly. The argument <em>set_pid</em> of this plugin should be set to false, because otherwise a pid controller is used, that is the “default” gazebo one (see plugin page for more info). And also when mimicking, we want to reply exactly the angle of the other joint (or not?). See above how to deal with this plugin if your urdf model has some mimic joint</p>
</div>
</div>
<div class="section" id="how-to-install">
<h2>How to Install<a class="headerlink" href="#how-to-install" title="Permalink to this headline">¶</a></h2>
<p><strong>NOTE</strong> You probably already installed this if you have followed the steps in <a class="reference internal" href="install.html#install"><span class="std std-ref">Install</span></a> section</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/roboticsgroup/roboticsgroup_gazebo_plugins.git <span class="c1">#necessary external plugin</span>
git clone -b &lt;branch_you_want&gt; https://github.com/ADVRHumanoids/rosee_gazebo_plugins.git

compile with catkin_make
</pre></div>
</div>
</div>
<div class="section" id="prepare-your-model-for-gazebo">
<span id="prepare4gazebo"></span><h2>Prepare your Model for Gazebo<a class="headerlink" href="#prepare-your-model-for-gazebo" title="Permalink to this headline">¶</a></h2>
<p>You need additional steps on your <em>.urdf</em> file to make Gazebo simulation works.</p>
<ul>
<li><p class="first">Be sure to have an urdf file ready for gazebo (info <a class="reference external" href="http://gazebosim.org/tutorials/?tut=ros_urdf">here</a>).
<span class="raw-html"><br /></span>
Also add in your <em>.urdf</em> :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gazebo&gt;</span>
  <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;SOMENAME&quot;</span> <span class="na">filename=</span><span class="s">&quot;librosee_plugin.so&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;/plugin&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p><span class="raw-html"><br /></span></p>
</li>
<li><p class="first">Add <em>rosee_gazebo_plugins_args</em> node in the main <em>yaml</em> config file <em>your_hand.yaml</em>, that you have created before as instructed in <a class="reference internal" href="usage.html#preparethefiles"><span class="std std-ref">Prepare the files</span></a> section. In this node you have a controller for each actuated joint, specifing
the controller type, the joint which is controlled, and the pid gains.
An example is below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ROSEndEffector</span><span class="p">:</span>
  <span class="nt">urdf_path</span><span class="p">:</span> <span class="s">&quot;urdf/my_hand.urdf&quot;</span>
  <span class="nt">srdf_path</span><span class="p">:</span> <span class="s">&quot;srdf/my_hand.srdf&quot;</span>
<span class="c1"># ^^^^^^^^^^^^^^^^^^^^^^^^^^^^   -- &gt; you should already have these lines</span>

<span class="nt">rosee_gazebo_plugins_args</span><span class="p">:</span>

  <span class="nt">joint_1_controller_name</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">JointPositionController</span>
    <span class="nt">joint_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">JOINT NAME</span>
    <span class="nt">pid</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt">p</span><span class="p">:</span> <span class="nv">0.3</span><span class="p p-Indicator">,</span><span class="nt"> i</span><span class="p">:</span> <span class="nv">0.001</span><span class="p p-Indicator">,</span><span class="nt"> d</span><span class="p">:</span> <span class="nv">0.00005</span><span class="p p-Indicator">}</span>

<span class=" -Error"> </span><span class="nt">joint_2_controller_name</span><span class="p">:</span>
   <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<ul class="simple">
<li>Be sure to put different controller names</li>
<li>Supported controllers <em>type</em> are <em>JointPositionController</em> and <em>JointVelocityController</em>, but for now ROS End-Effector only send position reference (so use <em>JointPositionController</em> for now).
<span class="raw-html"><br /></span>
In truth there exists also <em>JointEffortController</em>, we will implement this in future if gazebo will allow it (it is not possible in gazebo 7)</li>
<li>The pid gains are settable online thanks to the <em>DynReconfigure</em> node. This exploits a ROS tool called <em>Dynamic reconfigurator server</em>. The node is inside this package</li>
</ul>
<p><span class="raw-html"><br /></span></p>
</li>
<li><p class="first"><strong>Important</strong>: if your urdf file has some mimic joints, you have to add a <a class="reference external" href="https://github.com/roboticsgroup/roboticsgroup_gazebo_plugins">mimic_joint_plugin</a> for each one, like below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&quot;base_to_right_finger&quot;</span> <span class="na">type=</span><span class="s">&quot;revolute&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">&quot;0 0 1&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;limit</span> <span class="na">effort=</span><span class="s">&quot;1000.0&quot;</span> <span class="na">lower=</span><span class="s">&quot;-0.7&quot;</span> <span class="na">upper=</span><span class="s">&quot;0.0&quot;</span> <span class="na">velocity=</span><span class="s">&quot;0.5&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&quot;base&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&quot;right_finger&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&quot;.1 0 0&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;mimic</span> <span class="na">joint=</span><span class="s">&quot;base_to_left_finger&quot;</span> <span class="na">multiplier=</span><span class="s">&quot;-1&quot;</span> <span class="na">offset=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/joint&gt;</span>
<span class="c">&lt;!-- ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ this is the mimic joint --&gt;</span>

<span class="nt">&lt;gazebo&gt;</span>
  <span class="nt">&lt;plugin</span> <span class="na">filename=</span><span class="s">&quot;libroboticsgroup_gazebo_mimic_joint_plugin.so&quot;</span> <span class="na">name=</span><span class="s">&quot;base_to_right_finger_jointmimic_joint_plugin&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;joint&gt;</span>base_to_left_finger<span class="nt">&lt;/joint&gt;</span>
  <span class="nt">&lt;mimicJoint&gt;</span>base_to_right_finger<span class="nt">&lt;/mimicJoint&gt;</span>
  <span class="nt">&lt;multiplier&gt;</span>-1.0<span class="nt">&lt;/multiplier&gt;</span>
  <span class="nt">&lt;offset&gt;</span>0<span class="nt">&lt;/offset&gt;</span>
  <span class="nt">&lt;sensitiveness&gt;</span>0.0<span class="nt">&lt;/sensitiveness&gt;</span>
  <span class="c">&lt;!-- if absolute difference between setpoint and process value is below this threshold, do nothing; 0.0 = disable [rad] --&gt;</span>
  <span class="nt">&lt;maxEffort&gt;</span>1000.0<span class="nt">&lt;/maxEffort&gt;</span>
  <span class="nt">&lt;/plugin&gt;</span>
<span class="nt">&lt;/gazebo&gt;</span>
</pre></div>
</div>
<p>This example is taken from <em>configs/urdf/two_finger_mimic.urdf</em> file.
<span class="raw-html"><br /></span>
If you like to use xacro macros to add this plugin, you can create one in this way:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:macro</span> <span class="na">name=</span><span class="s">&quot;mimic_joint_plugin_gazebo&quot;</span> <span class="na">params=</span><span class="s">&quot;name_prefix parent_joint mimic_joint has_pid:=false multiplier:=1.0 offset:=0 sensitiveness:=0.0 max_effort:=1.0 robot_namespace:=&#39;&#39;&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;gazebo&gt;</span>
  <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">&quot;${name_prefix}mimic_joint_plugin&quot;</span> <span class="na">filename=</span><span class="s">&quot;libroboticsgroup_gazebo_mimic_joint_plugin.so&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;joint&gt;</span>${parent_joint}<span class="nt">&lt;/joint&gt;</span>
      <span class="nt">&lt;mimicJoint&gt;</span>${mimic_joint}<span class="nt">&lt;/mimicJoint&gt;</span>
      <span class="nt">&lt;xacro:if</span> <span class="na">value=</span><span class="s">&quot;${has_pid}&quot;</span><span class="nt">&gt;</span>                     <span class="c">&lt;!-- if set to true, PID parameters from &quot;/gazebo_ros_control/pid_gains/${mimic_joint}&quot; are loaded --&gt;</span>
           <span class="nt">&lt;hasPID</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/xacro:if&gt;</span>
      <span class="nt">&lt;multiplier&gt;</span>${multiplier}<span class="nt">&lt;/multiplier&gt;</span>
      <span class="nt">&lt;offset&gt;</span>${offset}<span class="nt">&lt;/offset&gt;</span>
      <span class="nt">&lt;sensitiveness&gt;</span>${sensitiveness}<span class="nt">&lt;/sensitiveness&gt;</span>   <span class="c">&lt;!-- if absolute difference between setpoint and process value is below this threshold, do nothing; 0.0 = disable [rad] --&gt;</span>
      <span class="nt">&lt;maxEffort&gt;</span>${max_effort}<span class="nt">&lt;/maxEffort&gt;</span>              <span class="c">&lt;!-- only taken into account if has_pid:=true [Nm] --&gt;</span>
      <span class="nt">&lt;xacro:unless</span> <span class="na">value=</span><span class="s">&quot;${robot_namespace == &#39;&#39;}&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;robotNamespace&gt;</span>($robot_namespace)<span class="nt">&lt;/robotNamespace&gt;</span>
      <span class="nt">&lt;/xacro:unless&gt;</span>
  <span class="nt">&lt;/plugin&gt;</span>
  <span class="nt">&lt;/gazebo&gt;</span>
<span class="nt">&lt;/xacro:macro&gt;</span>
</pre></div>
</div>
<p>And then use it:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:mimic_joint_plugin_gazebo</span> <span class="na">name_prefix=</span><span class="s">&quot;base_to_right_finger_joint&quot;</span>
  <span class="na">arent_joint=</span><span class="s">&quot;base_to_left_finger&quot;</span> <span class="na">mimic_joint=</span><span class="s">&quot;base_to_right_finger&quot;</span>
  <span class="na">has_pid=</span><span class="s">&quot;false&quot;</span> <span class="na">multiplier=</span><span class="s">&quot;-1.0&quot;</span> <span class="na">max_effort=</span><span class="s">&quot;1000.0&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>This example is taken from <em>configs/urdf/two_finger_mimic.urdf.xacro</em> file.
<span class="raw-html"><br /></span>
The macro is taken from <a class="reference external" href="https://github.com/mintar/mimic_joint_gazebo_tutorial">mimic_joint_gazebo_tutorial</a>.</p>
</li>
</ul>
</div>
<div class="section" id="how-to-run">
<h2>How to Run<a class="headerlink" href="#how-to-run" title="Permalink to this headline">¶</a></h2>
<p>To run ROS End-Effector as a whole, follow the guide in <a class="reference internal" href="usage.html#usage"><span class="std std-ref">How to use ROS End-Effector with your End-Effector</span></a> section.</p>
<ul>
<li><p class="first">Anyway, ROS End-Effector Gazebo Plugins is a package that run independently, so you can also launch it alone:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roslaunch rosee_gazebo_plugins twofinger.launch
</pre></div>
</div>
</li>
<li><p class="first">To run the dynamic reconfigurator:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rosrun rosee_gazebo_plugins DynReconfigure two_finger
</pre></div>
</div>
</li>
<li><p class="first">Also useful</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rqt
</pre></div>
</div>
<p>And set it to have things like that, for example to tune the gains:</p>
<a class="reference internal image-reference" href="_images/rqt.png"><img alt="rqt gui" src="_images/rqt.png" style="width: 700px;" /></a>
</li>
</ul>
</div>
<div class="section" id="advanced">
<h2>Advanced<a class="headerlink" href="#advanced" title="Permalink to this headline">¶</a></h2>
<p>Advanced section only for the braves</p>
<div class="section" id="change-more-params-with-dynamic-reconfigurator">
<h3>Change more params with Dynamic Reconfigurator<a class="headerlink" href="#change-more-params-with-dynamic-reconfigurator" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check the ros tutorials about that ( <a class="reference external" href="http://wiki.ros.org/dynamic_reconfigure/Tutorials">here</a> )</li>
<li>Add (or extend) config files in <em>rosee_gazebo_plugins/cfg</em> folder</li>
<li>Check the DynReconfigure code in <em>src/DynReconfigure</em></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="issues.html" class="btn btn-neutral float-right" title="Possible Issues" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="roseeGui.html" class="btn btn-neutral float-left" title="ROS End-Effector GUI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Luca Muratore, Davide Torielli

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>